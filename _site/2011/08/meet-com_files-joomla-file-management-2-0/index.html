<p>The Joomla Media Manager is currently a hermetically sealed black box which has been around since the Mambo days. It neither allows extending it, nor can it be easily re-used by developers. Over the past few weeks we have been giving it some much needed love and re-build it from the ground up. Meet : com_files !</p>

<p>For the diehards, in Joomla this component is called com_media. We gave it a new name to better reflect its use and to allow you to also install it in Joomla site. In good Nooku tradition com_files is fully re-usable and extend-able.</p>

<p><a href="http://www.flickr.com/photos/nooku/5859545823/" title="Nooku Server - Files by Nooku, on Flickr"><img src="http://farm6.static.flickr.com/5106/5859545823_0c90031377.jpg" alt="Nooku Server - Files" width="500" height="227" /></a></p>

<p>If you check out our <a href="http://demo.nooku.org/administrator/index.php?option=com_files&amp;view=files#/">Nooku Server demo</a> you will notice that the user interface looks very similar to that of Joomla. Don’t let yourself be fooled by the looks. Under the hood this baby has a completely new and shiny engine.</p>

<p>In this blog I’ll walk you over the key points of the refactor and at the end I’ll show you how you can easily integrate this component in your own solutions.</p>

<!--more-->

<h3 id="ajaxified-for-extendibility">AJAXified for extendibility</h3>

<p>Joomla’s com_media is using iframes and server side rendered HTML. This works but doesn’t give a great amount of flexibility and extendibility.</p>

<p>So we put Mootools to good work and AJAXified it. File listings, thumbnail generation (more about this in a bit), deletes, uploads, … are now all done via AJAX.</p>

<p>These changes not only make the code very flexible and extendible they also make the user experience a lot more snappy, did we say a lot lot more!</p>

<h3 id="restful-out-of-the-box">RESTful out of the box</h3>

<p>Nooku Framework implements a <a href="http://martinfowler.com/articles/richardsonMaturityModel.html#level2">ROA (Resource Oriented Architecture) of level 2</a>. Every component build on Nooku Framework is auto-magically ROA level 2 and so is com_files! In fact, com_files UI is an AJAX client that consumes this REST service.</p>

<p>By exposing a REST API we allow developers to integrate the desktop and the web. For example, you could write a mobile app that would immediately upload the pictures you take with your camera to your site.<em>**</em></p>

<h3 id="html5-support-built-in">HTML5 support built in</h3>

<p>Thanks to the folks at <a href="http://www.plupload.com/">http://www.plupload.com</a> we now have a multi file uploader that supports all HTML5 file upload features of your browser of choice (even in mobile). You can select multiple files, rename them as you wish, hit upload and be done.</p>

<p>You (or your customers) still don’t have a modern browser? Flash is also supported as a fallback for those stuck in 2010. So you still get AJAX multi-uploads. Need to upload 30 images at once, no problem we have it covered.</p>

<h3 id="speedy-thumbnails">Speedy thumbnails</h3>

<p>When you have hundreds of images in a folder, com_media loads all of them one by one. Resulting in your CPU fans going crazy and pages loading slow. We solved this by paginating results just like any other component and we also created a thumbnail cache using <a href="http://en.wikipedia.org/wiki/Data_URI_scheme">Data URI</a>’s.</p>

<p>When you navigate to a folder, a subsequent AJAX request will be issued to fetch all thumbnails on the current page. This means you will get all your thumbnails in one HTTP request which gives a great speed boost. Combined with the view cache that is coming in Nooku Framework Alpha 4 file browsing will be super fast! Did we say, super super fast!<br />
<em>**</em></p>

<h3 id="re-use-and-remix">Re-use and remix</h3>

<p>In Joomla the com_media manager is tied to a single folder and the code is not re-usable. As a result a lot of Joomla extensions have their own build in upload and file management code. We like to keep our code DRY !</p>

<p>Our Nooku files component solves all that! It’s not tied to a single folder anymore, instead it implements ‘containers’. Containers can be linked to the local file system, and in future also to cloud file systems (S3, Dropbox, … )</p>

<p>To add your own custom container all you need to do is:</p>

<pre class="brush: php; toolbar: false;">KFactory::tmp('admin::com.files.controller.container')-&gt;add(array(
'id' =&gt; 'com_mycomponent.myview', /*unique container id*/
'path' =&gt; 'pathtomyfiles' /*folder starting from the site root*/
));</pre>

<p>To create your own instance of com_files and displaying it is as simple as making one HMVC call:</p>

<pre class="brush: php; toolbar: false;">&lt;?= KFactory::tmp('admin::com.files.controller.file')
-&gt;container('com_mycomponent.myview')
-&gt;types(array('file', 'image')) /*optional*/
-&gt;layout('default') /*compact for modal view*/
-&gt;display(); ?&gt;</pre>

<p>The AJAX implementation is fully customizable and exposes numerous JavaScript events for you to hook to customize the workflow. For example to catch folder navigations you can hook into afterNavigate event of the application.</p>

<pre class="brush: js; toolbar: false;">&lt;script&gt;
window.addEvent('domready', function() {
/* Files.app is the current running instance
* It holds the references to all components
*/
Files.app.addEvent('afterNavigate', function(path) {
alert('You just navigated to '+path);
});
})</pre>

<p>These are just a few simple code examples to show you the immense power of this component and how to leverage it. Time to dive in yourself!</p>

<h3 id="show-me-the-code">Show me the code</h3>

<p>The com_files component can be found in our<a href="https://nooku.assembla.com/spaces/nooku-components"> Nooku Components space</a>. Give it a spin and let us know how you like it!</p>

<p>Happy coding !</p>

