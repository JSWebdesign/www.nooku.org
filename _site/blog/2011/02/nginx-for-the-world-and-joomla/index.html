<!DOCTYPE html>
<!--[if IE 8]> <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width" />
    <title>Nginx for the world&#8230; and Joomla</title>
    <meta name="description" content="Open Source PHP Framework for Web Applications. A project for developers integrators and hackers alike. Through collaboration we innovate and grow Nooku." />

    <link rel="shortcut icon" type="image/ico" href="/assets/img/favicon.ico" />
    <link href="/assets/css/prism.css" rel="stylesheet" type="text/css">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,400,300,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/css/style.css">

    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-214238-5', 'nooku.org');
        ga('send', 'pageview');

    </script>
</head>
<body>

<div id="wrapper">
    <div class="section header">
        <div class="container container-centered">
            <div class="row">
                <div class="brand col-sm-6">
                    <a href="/"><img src="/assets/img/logo.jpg" height="60px" width="123px" /></a>
                </div>
                <div class="col-sm-6">
                    <div class="navbar" role="navigation">
                        <div class="container-fluid">
                            <ul class="nav navbar-nav">
                                
                                
                                
                                <li class="" role="menuitem">
                                    <a href="/">About</a>
                                </li>
                                
                                
                                
                                <li class="" role="menuitem">
                                    <a href="/manifesto">Manifesto</a>
                                </li>
                                
                                
                                
                                <li class="active" role="menuitem">
                                    <a href="/blog">Blog</a>
                                </li>
                                
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="section blog">
        <div class="container">
            <div class="row">
                <div class="col-sm-9">
                    <h2>
                        Nginx for the world&#8230; and Joomla
                    </h2>
                    <h3 class="text-muted">
                        28 February 2011 by Shayne
                    </h3>
          
                    <p>After months of discussion on the virtues of cloud servers and Nginx, I was recently tasked with moving all the Nooku sites over to <a href="https://timble.assembla.com/spaces/nooku-desktop/admin/general">Rackspace Cloud</a>. With that in mind, I have documented the basic install process for the benefit of all.</p>

<p>For our install, we will be using <a href="http://www.ubuntu.com/">Ubuntu</a> 10.04 and installing/configuring:</p>

<div>
  <ul>
    <li>
      PHP 5.3.x (using <a href="http://php-fpm.org/">fpm-php</a> which is included)
    </li>
    <li>
      MySQL 5.x
    </li>
    <li>
      <a href="http://nginx.org/">Nginx</a> 8.x
    </li>
  </ul>
</div>

<div>
  In this tutorial I will take you through the install and the outline how I have set things up to gain maximum performance.
</div>

<!--more-->

<h3 id="install-php">Install PHP</h3>

<p>First, we update the repositories so we get the right version of PHP.</p>

<pre class="brush:bash">aptitude install python-software-properties
add-apt-repository ppa:brianmercer/php
aptitude -y update</pre>

<p>We can now install everything we need.</p>

<pre class="brush:bash">aptitude install php5-cli php5-common php5-mysql
aptitude install php5-fpm php5-cgi php-pear php5-memcache php-apc
service php5-fpm start</pre>

<p>You may notice I have included memcache. Whilst I’m not configuring it in this install, I have been exploring Nooku Server’s ability to use memcache and Nginx’s inherent ability to serve memcached pages directly, hence no php process… ergo increased speed and less resource usage.</p>

<p>Configure FPM by switching pm to dynamic (it is static by default). Then set up the following with values appropriate to your server specification. I use vi but you can use your preferred editor.</p>

<pre class="brush:bash">vi /etc/php5/fpm/php5-fpm.conf</pre>

<p>Then set</p>

<pre class="brush:bash">pm = dynamic</pre>

<p>and set values for</p>

<pre class="brush:bash">pm.max_children=
pm.start_servers=
pm.min_spare_servers=
pm.max_spare_servers=
pm.max_requests=</pre>

<p>Once you are done, save and exit then restart FPM.</p>

<pre class="brush:bash">service php5-fpm restart</pre>

<h3 id="install-mysql">Install mySQL</h3>

<p>Nothing too special here, perform the normal installation. Remember to note the password you set during the install process.</p>

<pre class="brush:bash">aptitude install mysql-server</pre>

<p>Next, configure Query Cache. Bring up the msql prompt (entering the password you created earlier).</p>

<pre class="brush:bash">mysql -p -u root</pre>

<p>Then set the query_cache_size. I have found 56MB to be sufficient for most Joomla! installs.</p>

<pre class="brush:bash">set global query_cache_size= 5600000;</pre>

<p>When you installed mySQL,  it created a root user and password. This user has full privileges on all DB’s so it is best to create a unique user for your Nooku Server or Joomla! installation.</p>

<pre class="brush:bash">CREATE USER ‘username’@‘localhost’ IDENTIFIED BY ‘password’;</pre>

<p>Since we are already here, we might as well create the database itself.</p>

<pre class="brush:bash">CREATE DATABASE databasename ;</pre>

<p>Do not forget  to grant the new user access to the new database.</p>

<pre class="brush:bash">GRANT ALL PRIVILEGES ON databasename.* to ‘username’@‘localhost’</pre>

<p>That is about it for mySQL.  We can then exit.</p>

<pre class="brush:bash">exit;</pre>

<p>If you prefer using a GUI, and assuming you have SSH access, you will be able to access mySQL via SSH using Sequal Pro, Navicat or any similar software. Avoid the temptation to provide wildcard access to mySQL.</p>

<h3 id="install-nginx">Install Nginx</h3>

<p>Next up, we install Nginx. The following will ensure you get version 8 rather than version 7,  which is what you would otherwise install.</p>

<pre class="brush:bash">echo "deb http://ppa.launchpad.net/nginx/stable/ubuntu lucid main" &gt;&gt; /etc/apt/sources.list
apt-key adv --keyserver keyserver.ubuntu.com --recv-keys C300EE8C
apt-get update</pre>

<p>Then install with the command below:</p>

<pre class="brush:bash">apt-get install nginx</pre>

<h3 id="setting-up-a-site">Setting up a site</h3>

<p>This will get you started with a fresh Joomla! install. We will first set up a folder structure for the site, then create a database for use on the site. We then finally download and extract the Joomla! source code into the site root folder.</p>

<p>Start by creating a root folder for your site (this could be in an alternative location).</p>

<pre class="brush:bash">mkdir -p /var/www/sitename/public
mkdir -p /var/www/sitename/logs</pre>

<p>We can now grab the latest Joomla! or <a href="https://nooku.assembla.com/code/nooku-server/subversion/nodes">Nooku Server</a> release.</p>

<pre class="brush:bash">wget http://joomlacode.org/gf/download/frsrelease/13105/57239/Joomla_1.5.22-Stable-Full_Package.tar.gz</pre>

<p>Then unpack it.</p>

<pre class="brush:bash">tar xzvf Joomla_1.5.22-Stable-Full_Package.tar.gz</pre>

<p>Then set permissions just to be safe.</p>

<pre class="brush:bash">chown -fR www-data:www-data /var/www/sitename/public
find /var/www/sitename/public -type f -exec chmod 644 {} \;
find /var/www/sitename/public -type d -exec chmod 755 {} \;</pre>

<p>We now need to set up a configuration file (conf) for the site. Nginx supplies a default site conf in /etc/nginx/sites-available called default. To start with your conf file, I would suggest copying the default.</p>

<pre class="brush:bash">cp /etc/nginx/sites-available/default /etc/nginx/sites-available/sitename</pre>

<p>We can then edit the copied conf file.</p>

<pre class="brush:bash">vi /etc/nginx/sites-available/sitename</pre>

<p>I’m only going to show the basics here, but for 90% of sites, this is all you need in your conf file.</p>

<pre class="brush:bash">server {
    # The port number (80 for http)
    listen       80;</pre>

<pre class="brush:bash"># The domain name
    server_name  domainname.com www.domainname.com;</pre>

<pre class="brush:bash"># The public root folder of the site
    root   /var/www/domainname.com/public;</pre>

<pre class="brush:bash"># The default index file.
    index  index.php;</pre>

<pre class="brush:bash"># Where to write the site access log
    access_log  /var/www/domainname.com/logs/site.access.log  main;
# File uploads
client_max_body_size 10M;
client_body_buffer_size 128k;
# Add www to all urls
if ($host ~* ^([a-z0-9\-]+\.(be|fr|nl|de))$) {
rewrite ^(.*)$ http://www.$host$1 permanent;
}
    location / {
        expires 1d;
        # Note that nginx does not use .htaccess.
        # This will allow for SEF URL’s
        try_files $uri $uri/ /index.php?$args;
    }

    # Here we set up static files access and caching
    location ~* ^.+\.(jpg|jpeg|gif|png|ico|css|zip|tgz|gz|rar|bz2|doc|xls|exe|pdf|ppt|txt|tar|mid|midi|wav|bmp|rtf|js)	$ {
        access_log off;
        expires 30d;
    }

    error_page  404              /404.html;
    location = /404.html {
        root   /usr/share/nginx/html;
    }

    # redirect server error pages to the static page /50x.html
    #
    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   /usr/share/nginx/html;
    }

    proxy_cache_key "$host$request_uri$cookie_sessioncookie";

    # Send PHP scripts to FPM on 127.0.0.1:9000
    location ~ \.php$ {
        fastcgi_pass   127.0.0.1:9000;
        fastcgi_index  index.php;
        fastcgi_param  SCRIPT_FILENAME /var/www/public$fastcgi_script_name;
        include        fastcgi_params;
        expires 0d;
    }
}</pre>

<p>Save your conf file. Next up, we need to symlink the site’s conf file into /etc/nginx/sites-enabled.</p>

<pre class="brush:bash">ln -s /etc/nginx/sites-available/sitename /etc/nginx/sites-enabled/sitename</pre>

<p>Finally restart the Nginx service so that the new settings are applied.</p>

<pre class="brush:bash">service nginx restart</pre>

<p>Assuming you have created the appropriate DNS records you should now be able to get to your site. If you downloaded and extracted Joomla! correctly, you should be seeing the install screen.</p>

<p>From there you should be on your way. Enjoy!</p>


                    
                    <hr>
                    <div id="disqus_thread"></div>
                    <script type="text/javascript">
                        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                        var disqus_shortname = 'nooku'; // required: replace example with your forum shortname
                        var disqus_identifier = '241999766';
                        var disqus_url = 'http://blog.nooku.org/blog/2011/02/nginx-for-the-world-and-joomla/';

                        /* * * DON'T EDIT BELOW THIS LINE * * */
                        (function() {
                            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                        })();
                    </script>
                    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                </div>
                <div class="col-sm-3">
                    <ul>
                        
                            
                            
                            
                                <li><a href="/blog/2014/06">June 2014</a></li>
                                 
                            
                        
                            
                            
                            
                                <li><a href="/blog/2013/03">March 2013</a></li>
                                 
                            
                        
                            
                            
                            
                        
                            
                            
                            
                                <li><a href="/blog/2012/09">September 2012</a></li>
                                 
                            
                        
                            
                            
                            
                                <li><a href="/blog/2012/06">June 2012</a></li>
                                 
                            
                        
                            
                            
                            
                                <li><a href="/blog/2012/05">May 2012</a></li>
                                 
                            
                        
                            
                            
                            
                                <li><a href="/blog/2012/04">April 2012</a></li>
                                 
                            
                        
                            
                            
                            
                        
                            
                            
                            
                        
                            
                            
                            
                                <li><a href="/blog/2012/03">March 2012</a></li>
                                 
                            
                        
                            
                            
                            
                        
                            
                            
                            
                        
                            
                            
                            
                                <li><a href="/blog/2012/01">January 2012</a></li>
                                 
                            
                        
                            
                            
                            
                        
                            
                            
                            
                                <li><a href="/blog/2011/12">December 2011</a></li>
                                 
                            
                        
                            
                            
                            
                        
                            
                            
                            
                        
                            
                            
                            
                                <li><a href="/blog/2011/11">November 2011</a></li>
                                 
                            
                        
                            
                            
                            
                        
                            
                            
                            
                        
                            
                            
                            
                                <li><a href="/blog/2011/10">October 2011</a></li>
                                 
                            
                        
                            
                            
                            
                        
                            
                            
                            
                        
                            
                            
                            
                        
                            
                            
                            
                                <li><a href="/blog/2011/09">September 2011</a></li>
                                 
                            
                        
                            
                            
                            
                                <li><a href="/blog/2011/08">August 2011</a></li>
                                 
                            
                        
                            
                            
                            
                        
                            
                            
                            
                        
                            
                            
                            
                                <li><a href="/blog/2011/07">July 2011</a></li>
                                 
                            
                        
                            
                            
                            
                        
                            
                            
                            
                                <li><a href="/blog/2011/05">May 2011</a></li>
                                 
                            
                        
                            
                            
                            
                        
                            
                            
                            
                        
                            
                            
                            
                                <li><a href="/blog/2011/04">April 2011</a></li>
                                 
                            
                        
                            
                            
                            
                        
                            
                            
                            
                        
                            
                            
                            
                        
                            
                            
                            
                        
                            
                            
                            
                                <li><a href="/blog/2011/03">March 2011</a></li>
                                 
                            
                        
                            
                            
                            
                        
                            
                            
                            
                                <li><a href="/blog/2011/02">February 2011</a></li>
                                 
                            
                        
                            
                            
                            
                        
                            
                            
                            
                        
                            
                            
                            
                        
                            
                            
                            
                        
                            
                            
                            
                                <li><a href="/blog/2011/01">January 2011</a></li>
                                 
                            
                        
                            
                            
                            
                        
                            
                            
                            
                        
                            
                            
                            
                        
                            
                            
                            
                        
                            
                            
                            
                        
                            
                            
                            
                                <li><a href="/blog/2010/12">December 2010</a></li>
                                 
                            
                        
                            
                            
                            
                        
                            
                            
                            
                        
                            
                            
                            
                        
                            
                            
                            
                        
                            
                            
                            
                        
                            
                            
                            
                        
                            
                            
                            
                        
                            
                            
                            
                                <li><a href="/blog/2010/11">November 2010</a></li>
                                 
                            
                        
                            
                            
                            
                        
                            
                            
                            
                        
                            
                            
                            
                                <li><a href="/blog/2010/10">October 2010</a></li>
                                 
                            
                        
                            
                            
                            
                        
                            
                            
                            
                                <li><a href="/blog/2010/09">September 2010</a></li>
                                 
                            
                        
                            
                            
                            
                        
                            
                            
                            
                                <li><a href="/blog/2010/08">August 2010</a></li>
                                 
                            
                        
                            
                            
                            
                        
                            
                            
                            
                                <li><a href="/blog/2010/07">July 2010</a></li>
                                 
                            
                        
                            
                            
                            
                        
                            
                            
                            
                        
                            
                            
                            
                                <li><a href="/blog/2010/06">June 2010</a></li>
                                 
                            
                        
                            
                            
                            
                        
                            
                            
                            
                                <li><a href="/blog/2010/05">May 2010</a></li>
                                 
                            
                        
                            
                            
                            
                        
                            
                            
                            
                        
                            
                            
                            
                        
                            
                            
                            
                                <li><a href="/blog/2010/04">April 2010</a></li>
                                 
                            
                        
                            
                            
                            
                        
                            
                            
                            
                        
                            
                            
                            
                                <li><a href="/blog/2010/03">March 2010</a></li>
                                 
                            
                        
                            
                            
                            
                                <li><a href="/blog/2009/11">November 2009</a></li>
                                 
                            
                        
                            
                            
                            
                                <li><a href="/blog/2009/09">September 2009</a></li>
                                 
                            
                        
                            
                            
                            
                        
                            
                            
                            
                                <li><a href="/blog/2009/08">August 2009</a></li>
                                 
                            
                        
                            
                            
                            
                        
                            
                            
                            
                                <li><a href="/blog/2009/07">July 2009</a></li>
                                 
                            
                        
                            
                            
                            
                                <li><a href="/blog/2009/06">June 2009</a></li>
                                 
                            
                        
                            
                            
                            
                        
                            
                            
                            
                        
                            
                            
                            
                        
                            
                            
                            
                                <li><a href="/blog/2009/05">May 2009</a></li>
                                 
                            
                        
                            
                            
                            
                        
                            
                            
                            
                                <li><a href="/blog/2009/04">April 2009</a></li>
                                 
                            
                        
                            
                            
                            
                        
                            
                            
                            
                                <li><a href="/blog/2009/03">March 2009</a></li>
                                 
                            
                        
                            
                            
                            
                        
                            
                            
                            
                        
                            
                            
                            
                        
                            
                            
                            
                        
                            
                            
                            
                                <li><a href="/blog/2008/11">November 2008</a></li>
                                 
                            
                        
                            
                            
                            
                        
                            
                            
                            
                        
                            
                            
                            
                                <li><a href="/blog/2008/09">September 2008</a></li>
                                 
                            
                        
                            
                            
                            
                        
                            
                            
                            
                        
                            
                            
                            
                        
                            
                            
                            
                        
                            
                            
                            
                        
                            
                            
                            
                                <li><a href="/blog/2008/08">August 2008</a></li>
                                 
                            
                        
                            
                            
                            
                        
                            
                            
                            
                                <li><a href="/blog/2008/06">June 2008</a></li>
                                 
                            
                        
                            
                            
                            
                                <li><a href="/blog/2008/05">May 2008</a></li>
                                 
                            
                        
                            
                            
                            
                        
                            
                            
                            
                                <li><a href="/blog/2008/04">April 2008</a></li>
                                 
                            
                        
                            
                            
                            
                        
                            
                            
                            
                        
                            
                            
                            
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>

<div class="section footer">
    <div class="container">
        <div class="row">
            <div class="col-sm-6">
                <p>
                    <a href="http://www.facebook.com/nooku.org">Facebook</a> |
                    <a href="http://www.twitter.com/nooku">Twitter</a> |
                    <a href="http://www.github.com/nooku">Github</a> |
                    <a href="/blog/rss.xml">RSS</a>
                </p>
            </div>
            <div class="copyright col-sm-6">
                <p>Copyright now <a href="http://www.timble.net">Timble</a></p>
            </div>
        </div>
    </div>
</div>
</div>
<script src="/assets/js/prism.js"></script>
</body>
</html>